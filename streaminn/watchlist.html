<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchlist - StreamHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .watchlist-card {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .watchlist-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .sidebar {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .content-area {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .content-area {
                margin-left: 0;
            }
        }
        
        .nav-item {
            transition: all 0.3s ease;
            border-radius: 12px;
        }
        
        .nav-item:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateX(8px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .filter-tab {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .filter-tab:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .filter-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: rgba(102, 126, 234, 0.8);
        }
        
        .empty-state {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .video-player {
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Navigation Sidebar -->
    <div class="fixed left-0 top-0 h-full w-72 sidebar z-50 hidden lg:block">
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-8">
                <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-play text-white text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-white">StreamHub</h1>
            </div>
            
            <nav class="space-y-3">
                <a href="index.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-gray-300">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="movies.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-gray-300">
                    <i class="fas fa-film"></i>
                    <span>Movies</span>
                </a>
                <a href="sports.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-gray-300">
                    <i class="fas fa-football-ball"></i>
                    <span>Live Sports</span>
                </a>
                <a href="search.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-gray-300">
                    <i class="fas fa-search"></i>
                    <span>Search</span>
                </a>
                <a href="watchlist.html" class="nav-item active flex items-center space-x-3 px-4 py-3 text-white">
                    <i class="fas fa-bookmark"></i>
                    <span>Watchlist</span>
                </a>
            </nav>
            
            <div class="mt-8 p-4 glass-effect rounded-xl">
                <h3 class="text-white font-semibold mb-2">Watchlist Stats</h3>
                <div class="space-y-2 text-sm text-gray-300">
                    <div class="flex justify-between">
                        <span>Total Items</span>
                        <span class="text-blue-400" id="totalItems">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Movies</span>
                        <span class="text-purple-400" id="movieCount">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>TV Shows</span>
                        <span class="text-green-400" id="tvCount">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>In Progress</span>
                        <span class="text-yellow-400" id="inProgressCount">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="lg:hidden fixed bottom-0 left-0 right-0 bg-black bg-opacity-90 backdrop-blur-lg border-t border-gray-800 z-50">
        <div class="flex justify-around py-3">
            <a href="index.html" class="flex flex-col items-center space-y-1 text-gray-400">
                <i class="fas fa-home text-lg"></i>
                <span class="text-xs">Home</span>
            </a>
            <a href="movies.html" class="flex flex-col items-center space-y-1 text-gray-400">
                <i class="fas fa-film text-lg"></i>
                <span class="text-xs">Movies</span>
            </a>
            <a href="sports.html" class="flex flex-col items-center space-y-1 text-gray-400">
                <i class="fas fa-football-ball text-lg"></i>
                <span class="text-xs">Sports</span>
            </a>
            <a href="search.html" class="flex flex-col items-center space-y-1 text-gray-400">
                <i class="fas fa-search text-lg"></i>
                <span class="text-xs">Search</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content-area min-h-screen pb-20 lg:pb-0">
        <!-- Header -->
        <header class="p-6 pb-0">
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-4xl font-bold text-white">My Watchlist</h1>
                <div class="flex items-center space-x-4">
                    <button id="clearAllBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-trash mr-2"></i>Clear All
                    </button>
                </div>
            </div>
            
            <!-- Filter Tabs -->
            <div class="flex flex-wrap gap-3 mb-6">
                <button class="filter-tab active px-4 py-2 text-white rounded-lg" data-filter="all">
                    <i class="fas fa-th-large mr-2"></i>All Items
                </button>
                <button class="filter-tab px-4 py-2 text-gray-300 rounded-lg" data-filter="movies">
                    <i class="fas fa-film mr-2"></i>Movies
                </button>
                <button class="filter-tab px-4 py-2 text-gray-300 rounded-lg" data-filter="tv">
                    <i class="fas fa-tv mr-2"></i>TV Shows
                </button>
                <button class="filter-tab px-4 py-2 text-gray-300 rounded-lg" data-filter="in-progress">
                    <i class="fas fa-clock mr-2"></i>In Progress
                </button>
                <button class="filter-tab px-4 py-2 text-gray-300 rounded-lg" data-filter="completed">
                    <i class="fas fa-check mr-2"></i>Completed
                </button>
            </div>
        </header>

        <!-- Watchlist Content -->
        <div class="p-6 pt-0">
            <!-- Empty State -->
            <div id="emptyState" class="empty-state rounded-xl p-12 text-center hidden">
                <i class="fas fa-bookmark text-6xl text-gray-600 mb-4"></i>
                <h3 class="text-2xl font-bold text-white mb-2">Your watchlist is empty</h3>
                <p class="text-gray-400 mb-6">Start adding movies and shows you want to watch later</p>
                <a href="movies.html" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-blue-600 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-blue-700 transition-all">
                    <i class="fas fa-film mr-2"></i>Browse Movies
                </a>
            </div>

            <!-- Watchlist Grid -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6" id="watchlistGrid">
                <!-- Watchlist items will be loaded here -->
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="flex justify-center items-center py-12 hidden">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
            </div>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="videoModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="bg-black rounded-xl max-w-6xl w-full mx-4">
            <div class="relative">
                <button onclick="closeVideoModal()" class="absolute top-4 right-4 z-10 w-10 h-10 bg-black bg-opacity-50 rounded-full flex items-center justify-center text-white hover:bg-opacity-75">
                    <i class="fas fa-times"></i>
                </button>
                <div class="video-player aspect-video">
                    <div id="mainVideoPlayer" class="w-full h-full">
                        <!-- Video player will be loaded here -->
                    </div>
                </div>
                <div class="p-4 flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <span class="text-white font-semibold" id="videoTitle">Content Title</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="watchlistPage.continueWatching()" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                            Continue Watching
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Watchlist page functionality
        class WatchlistPage {
            constructor() {
                this.apiKey = 'af9948790c4e5a90eadd97d97530a9c1';
                this.baseUrl = 'https://api.themoviedb.org/3';
                this.imageBaseUrl = 'https://image.tmdb.org/t/p/w500';
                this.currentFilter = 'all';
                this.watchlist = JSON.parse(localStorage.getItem('streamhub_watchlist') || '[]');
                this.watchlistData = [];
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupFilterTabs();
                this.loadWatchlist();
            }

            setupEventListeners() {
                const clearAllBtn = document.getElementById('clearAllBtn');
                if (clearAllBtn) {
                    clearAllBtn.addEventListener('click', () => this.clearAllWatchlist());
                }
            }

            setupFilterTabs() {
                const filterTabs = document.querySelectorAll('.filter-tab');
                filterTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Remove active class from all tabs
                        filterTabs.forEach(t => {
                            t.classList.remove('active', 'bg-gradient-to-r', 'from-purple-500', 'to-blue-600');
                            t.classList.add('text-gray-300');
                        });
                        
                        // Add active class to clicked tab
                        tab.classList.add('active', 'bg-gradient-to-r', 'from-purple-500', 'to-blue-600');
                        tab.classList.remove('text-gray-300');
                        tab.classList.add('text-white');
                        
                        // Update current filter
                        this.currentFilter = tab.dataset.filter;
                        this.filterWatchlist();
                    });
                });
            }

            async loadWatchlist() {
                this.showLoading();
                
                try {
                    const watchlistData = [];
                    
                    // Load detailed data for each item in watchlist
                    for (const itemId of this.watchlist) {
                        try {
                            // Try to get movie details first
                            const movieResponse = await fetch(`${this.baseUrl}/movie/${itemId}?api_key=${this.apiKey}`);
                            if (movieResponse.ok) {
                                const movieData = await movieResponse.json();
                                movieData.media_type = 'movie';
                                movieData.watchlistProgress = this.getWatchProgress(itemId);
                                watchlistData.push(movieData);
                                continue;
                            }
                            
                            // If not a movie, try TV show
                            const tvResponse = await fetch(`${this.baseUrl}/tv/${itemId}?api_key=${this.apiKey}`);
                            if (tvResponse.ok) {
                                const tvData = await tvResponse.json();
                                tvData.media_type = 'tv';
                                tvData.watchlistProgress = this.getWatchProgress(itemId);
                                watchlistData.push(tvData);
                            }
                        } catch (error) {
                            console.error(`Error loading item ${itemId}:`, error);
                        }
                    }
                    
                    this.watchlistData = watchlistData;
                    this.displayWatchlist();
                    this.updateStats();
                } catch (error) {
                    console.error('Error loading watchlist:', error);
                    this.displayWatchlist();
                } finally {
                    this.hideLoading();
                }
            }

            displayWatchlist() {
                const container = document.getElementById('watchlistGrid');
                const emptyState = document.getElementById('emptyState');
                
                if (this.watchlistData.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                
                container.innerHTML = this.watchlistData.map(item => {
                    if (item.media_type === 'movie') {
                        return this.renderMovieCard(item);
                    } else if (item.media_type === 'tv') {
                        return this.renderTVCard(item);
                    }
                    return '';
                }).join('');
            }

            renderMovieCard(movie) {
                const progress = movie.watchlistProgress;
                const hasProgress = progress && progress.progress > 0;
                
                return `
                    <div class="watchlist-card rounded-xl overflow-hidden cursor-pointer group" onclick="watchlistPage.showMovieDetail(${movie.id})">
                        <div class="relative">
                            <img src="${movie.poster_path ? this.imageBaseUrl + movie.poster_path : 'https://via.placeholder.com/300x450?text=No+Image'}" 
                                 alt="${movie.title}" class="w-full h-80 object-cover">
                            <div class="absolute top-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-sm">
                                <i class="fas fa-star text-yellow-400 mr-1"></i>
                                ${movie.vote_average.toFixed(1)}
                            </div>
                            ${hasProgress ? `
                                <div class="absolute bottom-2 left-2 right-2">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${Math.min(progress.progress, 100)}%"></div>
                                    </div>
                                    <div class="text-white text-xs mt-1">${Math.floor(progress.currentTime / 60)}:${(progress.currentTime % 60).toString().padStart(2, '0')} / ${Math.floor(progress.duration / 60)}:${(progress.duration % 60).toString().padStart(2, '0')}</div>
                                </div>
                            ` : ''}
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <div class="absolute bottom-4 left-4 right-4 space-y-2">
                                    ${hasProgress ? `
                                        <button class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="event.stopPropagation(); watchlistPage.continueMovie(${movie.id})">
                                            <i class="fas fa-play mr-2"></i>Continue
                                        </button>
                                    ` : `
                                        <button class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="event.stopPropagation(); watchlistPage.playMovie(${movie.id})">
                                            <i class="fas fa-play mr-2"></i>Watch Now
                                        </button>
                                    `}
                                    <button class="w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors" onclick="event.stopPropagation(); watchlistPage.removeFromWatchlist(${movie.id})">
                                        <i class="fas fa-trash mr-2"></i>Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="text-white font-semibold truncate mb-2">${movie.title}</h4>
                            <p class="text-gray-400 text-sm mb-2">${movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A'}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-blue-600 text-white px-2 py-1 rounded">Movie</span>
                                    <span class="text-xs text-gray-400">${Math.floor(Math.random() * 60 + 90)} min</span>
                                </div>
                                ${hasProgress ? `
                                    <span class="text-xs bg-green-600 text-white px-2 py-1 rounded">
                                        ${Math.round(progress.progress)}% watched
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            renderTVCard(tv) {
                const progress = tv.watchlistProgress;
                const hasProgress = progress && progress.progress > 0;
                
                return `
                    <div class="watchlist-card rounded-xl overflow-hidden cursor-pointer group" onclick="watchlistPage.showTVDetail(${tv.id})">
                        <div class="relative">
                            <img src="${tv.poster_path ? this.imageBaseUrl + tv.poster_path : 'https://via.placeholder.com/300x450?text=No+Image'}" 
                                 alt="${tv.name}" class="w-full h-80 object-cover">
                            <div class="absolute top-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-sm">
                                <i class="fas fa-star text-yellow-400 mr-1"></i>
                                ${tv.vote_average.toFixed(1)}
                            </div>
                            ${hasProgress ? `
                                <div class="absolute bottom-2 left-2 right-2">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${Math.min(progress.progress, 100)}%"></div>
                                    </div>
                                    <div class="text-white text-xs mt-1">Episode ${progress.episode || 1} - ${Math.round(progress.progress)}%</div>
                                </div>
                            ` : ''}
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <div class="absolute bottom-4 left-4 right-4 space-y-2">
                                    ${hasProgress ? `
                                        <button class="w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors" onclick="event.stopPropagation(); watchlistPage.continueTVShow(${tv.id})">
                                            <i class="fas fa-play mr-2"></i>Continue
                                        </button>
                                    ` : `
                                        <button class="w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors" onclick="event.stopPropagation(); watchlistPage.playTVShow(${tv.id})">
                                            <i class="fas fa-play mr-2"></i>Watch Now
                                        </button>
                                    `}
                                    <button class="w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors" onclick="event.stopPropagation(); watchlistPage.removeFromWatchlist(${tv.id})">
                                        <i class="fas fa-trash mr-2"></i>Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="text-white font-semibold truncate mb-2">${tv.name}</h4>
                            <p class="text-gray-400 text-sm mb-2">${tv.first_air_date ? new Date(tv.first_air_date).getFullYear() : 'N/A'}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-purple-600 text-white px-2 py-1 rounded">TV Show</span>
                                    <span class="text-xs text-gray-400">${tv.number_of_seasons || 1} seasons</span>
                                </div>
                                ${hasProgress ? `
                                    <span class="text-xs bg-green-600 text-white px-2 py-1 rounded">
                                        ${Math.round(progress.progress)}% watched
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            filterWatchlist() {
                let filteredData = [...this.watchlistData];
                
                if (this.currentFilter === 'movies') {
                    filteredData = filteredData.filter(item => item.media_type === 'movie');
                } else if (this.currentFilter === 'tv') {
                    filteredData = filteredData.filter(item => item.media_type === 'tv');
                } else if (this.currentFilter === 'in-progress') {
                    filteredData = filteredData.filter(item => {
                        const progress = this.getWatchProgress(item.id);
                        return progress && progress.progress > 0 && progress.progress < 100;
                    });
                } else if (this.currentFilter === 'completed') {
                    filteredData = filteredData.filter(item => {
                        const progress = this.getWatchProgress(item.id);
                        return progress && progress.progress >= 100;
                    });
                }
                
                // Temporarily update watchlistData for display
                const originalData = this.watchlistData;
                this.watchlistData = filteredData;
                this.displayWatchlist();
                this.watchlistData = originalData;
            }

            getWatchProgress(itemId) {
                const progressData = localStorage.getItem(`movie_progress_${itemId}`);
                return progressData ? JSON.parse(progressData) : null;
            }

            updateStats() {
                const total = this.watchlistData.length;
                const movies = this.watchlistData.filter(item => item.media_type === 'movie').length;
                const tv = this.watchlistData.filter(item => item.media_type === 'tv').length;
                const inProgress = this.watchlistData.filter(item => {
                    const progress = this.getWatchProgress(item.id);
                    return progress && progress.progress > 0 && progress.progress < 100;
                }).length;
                
                document.getElementById('totalItems').textContent = total;
                document.getElementById('movieCount').textContent = movies;
                document.getElementById('tvCount').textContent = tv;
                document.getElementById('inProgressCount').textContent = inProgress;
            }

            removeFromWatchlist(itemId) {
                this.watchlist = this.watchlist.filter(id => id !== itemId);
                localStorage.setItem('streamhub_watchlist', JSON.stringify(this.watchlist));
                
                // Remove progress data
                localStorage.removeItem(`movie_progress_${itemId}`);
                
                // Reload watchlist
                this.loadWatchlist();
                this.showNotification('Removed from watchlist', 'success');
            }

            clearAllWatchlist() {
                if (confirm('Are you sure you want to clear your entire watchlist?')) {
                    localStorage.removeItem('streamhub_watchlist');
                    
                    // Clear all progress data
                    this.watchlist.forEach(id => {
                        localStorage.removeItem(`movie_progress_${id}`);
                    });
                    
                    this.watchlist = [];
                    this.watchlistData = [];
                    this.displayWatchlist();
                    this.updateStats();
                    this.showNotification('Watchlist cleared', 'success');
                }
            }

            playMovie(movieId) {
                const modal = document.getElementById('videoModal');
                const videoPlayer = document.getElementById('mainVideoPlayer');
                const videoTitle = document.getElementById('videoTitle');
                
                // Use the actual vidking.net player with TMDB ID
                const playerUrl = `https://www.vidking.net/embed/movie/${movieId}?color=9146ff&autoPlay=true`;
                
                videoPlayer.innerHTML = `
                    <iframe src="${playerUrl}" 
                            width="100%" 
                            height="100%" 
                            frameborder="0" 
                            allowfullscreen
                            allow="autoplay; encrypted-media">
                    </iframe>
                `;
                
                videoTitle.textContent = `Movie ${movieId}`;
                modal.classList.remove('hidden');
            }

            playTVShow(tvId) {
                const modal = document.getElementById('videoModal');
                const videoPlayer = document.getElementById('mainVideoPlayer');
                const videoTitle = document.getElementById('videoTitle');
                
                // Use the actual vidking.net player with TMDB ID for TV shows
                const playerUrl = `https://www.vidking.net/embed/tv/${tvId}/1/1?color=9146ff&autoPlay=true`;
                
                videoPlayer.innerHTML = `
                    <iframe src="${playerUrl}" 
                            width="100%" 
                            height="100%" 
                            frameborder="0" 
                            allowfullscreen
                            allow="autoplay; encrypted-media">
                    </iframe>
                `;
                
                videoTitle.textContent = `TV Show ${tvId}`;
                modal.classList.remove('hidden');
            }

            continueMovie(movieId) {
                const progress = this.getWatchProgress(movieId);
                if (progress) {
                    // Continue from where left off
                    const playerUrl = `https://www.vidking.net/embed/movie/${movieId}?color=9146ff&autoPlay=true&progress=${Math.floor(progress.currentTime)}`;
                    this.playMovie(movieId);
                } else {
                    this.playMovie(movieId);
                }
            }

            continueTVShow(tvId) {
                const progress = this.getWatchProgress(tvId);
                if (progress && progress.season && progress.episode) {
                    // Continue from specific episode
                    const playerUrl = `https://www.vidking.net/embed/tv/${tvId}/${progress.season}/${progress.episode}?color=9146ff&autoPlay=true&progress=${Math.floor(progress.currentTime || 0)}`;
                    this.playTVShow(tvId);
                } else {
                    this.playTVShow(tvId);
                }
            }

            showMovieDetail(movieId) {
                // Redirect to movies page
                window.location.href = `movies.html#movie-${movieId}`;
            }

            showTVDetail(tvId) {
                // Redirect to a TV shows page or show modal
                console.log('Show TV detail for:', tvId);
            }

            showLoading() {
                const loading = document.getElementById('loadingState');
                loading.classList.remove('hidden');
            }

            hideLoading() {
                const loading = document.getElementById('loadingState');
                loading.classList.add('hidden');
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium transform translate-x-full transition-transform duration-300 ${
                    type === 'success' ? 'bg-green-600' : 
                    type === 'error' ? 'bg-red-600' : 'bg-blue-600'
                }`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
        }

        // Global functions
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const videoPlayer = document.getElementById('mainVideoPlayer');
            if (modal) {
                modal.classList.add('hidden');
                videoPlayer.innerHTML = '';
            }
        }

        // Initialize the watchlist page
        const watchlistPage = new WatchlistPage();
    </script>
</body>
</html>